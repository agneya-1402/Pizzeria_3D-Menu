<!DOCTYPE html>
<html>
<head>
    <title>AR Pizzeria Menu</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body { margin: 0; overflow: hidden; font-family: 'Poppins', sans-serif; }
        
        /* UI OVERLAY */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Let clicks pass through to AR if needed */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: rgba(0,0,0,0.1); /* Slight dim for better visibility */
        }

        /* HEADER */
        .header {
            padding: 20px;
            display: flex;
            justify-content: flex-end;
            pointer-events: auto;
        }
        .cart-btn {
            background: white;
            color: #C8102E; /* Pizza Red */
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border: none;
            cursor: pointer;
        }
        .badge {
            background: #C8102E;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 8px;
        }

        /* PIZZA INFO (Middle-Top) */
        .info-panel {
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            margin-top: 40px;
        }
        .pizza-name {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 2.5rem;
            margin: 0;
        }
        .pizza-price {
            font-size: 1.2rem;
            margin-top: 5px;
            font-weight: 300;
        }

        /* BOTTOM CONTROLS */
        .controls {
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            pointer-events: auto;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }

        .nav-btn {
            background: #C8102E;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
        }
        .nav-btn:active { transform: scale(0.9); }

        .add-btn {
            background: white;
            color: #C8102E;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
        }

        /* SCAN INSTRUCTION */
        #scan-prompt {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            pointer-events: none;
        }
    </style>
</head>

<body>

    <div id="ui-layer">
        <div class="header">
            <button class="cart-btn">
                Cart <span class="badge" id="cart-count">0</span>
            </button>
        </div>

        <div class="info-panel">
            <h1 class="pizza-name" id="p-name">Loading...</h1>
            <div class="pizza-price" id="p-price">₹ --</div>
        </div>

        <div class="controls">
            <button class="nav-btn" onclick="changePizza(-1)">←</button>
            <button class="add-btn" onclick="addToCart()">Add To Cart</button>
            <button class="nav-btn" onclick="changePizza(1)">→</button>
        </div>
    </div>

    <div id="scan-prompt">Point camera at the Menu Flyer!</div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
        
        <a-assets>
            <a-asset-item id="pizza-model" src="./assets/pizza_pack.glb"></a-asset-item>
        </a-assets>

        <a-marker type="pattern" url="./marker.patt" id="marker">
            
            <a-entity 
                id="pizza-entity"
                gltf-model="#pizza-model" 
                scale="0.5 0.5 0.5" 
                rotation="0 0 0"
                pizza-handler>
            </a-entity>

        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // === DATA: Match these to your model's actual mesh names or index ===
        // Since we have one file, we need to know the order or names. 
        // For now, we assume index 0 to 11 based on standard GLTF loading order.
        const pizzaMenu = [
            { name: "Pepperoni Pizza", price: 550 },
            { name: "Margherita", price: 450 },
            { name: "BBQ Chicken", price: 600 },
            { name: "Veggie Supreme", price: 500 },
            // ... add all 12 here
        ];

        let currentIndex = 0;
        let cartCount = 0;
        let pizzaMeshes = []; // To store the separated 3D parts

        // === AR MARKER EVENTS ===
        const marker = document.querySelector("#marker");
        const prompt = document.querySelector("#scan-prompt");

        marker.addEventListener("markerFound", () => {
            prompt.style.display = "none";
        });
        marker.addEventListener("markerLost", () => {
            prompt.style.display = "block";
        });

        // === THREE.JS CUSTOM COMPONENT ===
        AFRAME.registerComponent('pizza-handler', {
            init: function () {
                const el = this.el;
                
                el.addEventListener('model-loaded', () => {
                    const object3D = el.getObject3D('mesh');
                    
                    // TRAVERSE THE 3D MODEL
                    // This loops through every object in your GLB file
                    object3D.traverse((child) => {
                        if (child.isMesh) {
                            // Store mesh reference
                            pizzaMeshes.push(child);
                            
                            // Hide all initially
                            child.visible = false;
                        }
                    });

                    console.log("Found pizzas:", pizzaMeshes.length);
                    
                    // Show the first one
                    updatePizzaDisplay();
                });
            }
        });

        // === UI LOGIC ===
        function updatePizzaDisplay() {
            // 1. Update 3D Model
            if(pizzaMeshes.length > 0) {
                // Hide all
                pizzaMeshes.forEach(mesh => mesh.visible = false);
                
                // Show current (Ensure index wraps correctly)
                // Note: Sometimes GLTF exports have multiple meshes per object.
                // You might need to adjust logic if one pizza = multiple meshes.
                // Assuming 1 mesh per pizza for now:
                if(pizzaMeshes[currentIndex]) {
                    pizzaMeshes[currentIndex].visible = true;
                }
            }

            // 2. Update UI Text
            const data = pizzaMenu[currentIndex % pizzaMenu.length] || {name: "Unknown Pizza", price: 0};
            document.getElementById("p-name").innerText = data.name;
            document.getElementById("p-price").innerText = "₹ " + data.price + "/-";
        }

        function changePizza(direction) {
            currentIndex += direction;
            
            // Loop logic
            if (currentIndex < 0) currentIndex = pizzaMenu.length - 1;
            if (currentIndex >= pizzaMenu.length) currentIndex = 0;

            updatePizzaDisplay();
        }

        function addToCart() {
            cartCount++;
            document.getElementById("cart-count").innerText = cartCount;
            // Optional: Simple animation
            const btn = document.querySelector('.add-btn');
            btn.innerText = "Added!";
            setTimeout(() => btn.innerText = "Add To Cart", 1000);
        }
    </script>
</body>
</html>